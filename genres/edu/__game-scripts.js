var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),FollowCamera.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),FollowCamera.prototype.initialize=function(){this.pos=new pc.Vec3,this.offset=new pc.Vec3},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.offset.set(.75,1,.75).scale(this.distance),this.pos.copy(this.target.getPosition()).add(this.offset),this.pos.lerp(this.entity.getPosition(),this.pos,.1),this.entity.setPosition(this.pos))};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.spawnPos=this.entity.getPosition().clone()},Movement.prototype.update=function(e){if(this.entity.getPosition().y<-1)return void this.teleport(this.spawnPos);const t=this.app.keyboard;let s=0,i=0;if((t.isPressed(pc.KEY_LEFT)||t.isPressed(pc.KEY_A))&&(s=-this.speed),(t.isPressed(pc.KEY_RIGHT)||t.isPressed(pc.KEY_D))&&(s+=this.speed),(t.isPressed(pc.KEY_UP)||t.isPressed(pc.KEY_W))&&(i=-this.speed),(t.isPressed(pc.KEY_DOWN)||t.isPressed(pc.KEY_S))&&(i+=this.speed),this.force.set(s,0,i),this.force.lengthSq()>0){this.force.normalize().scale(this.speed);const e=.25*-Math.PI,t=Math.cos(e),s=Math.sin(e),i=this.force.x*t-this.force.z*s,o=this.force.z*t+this.force.x*s;this.force.set(i,0,o)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.teleport=function(e){this.entity.rigidbody.teleport(e),this.spawnPos.copy(e),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO};var Teleporter=pc.createScript("teleporter");Teleporter.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.target.getPosition().clone();e.y+=.5,t.script.movement.teleport(e);const r=this.app.root.findByName("Start-screen");r?r.enabled=!1:console.warn("Start-screen entity not found.");const n=this.app.root.findByName("Wildfire-screen");n?n.enabled=!0:console.warn("Wildfire-screen entity not found.")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};pc.script.createLoadingScreen((function(n){var e;(e=document.createElement("style")).type="text/css",e.appendChild(document.createTextNode("\n            body {\n                background-color: #283538;\n            }\n\n            #application-splash-wrapper {\n                position: absolute;\n                top: 0;\n                left: 0;\n                height: 100%;\n                width: 100%;\n                background-color: #283538;\n            }\n\n            #application-splash {\n                position: absolute;\n                top: calc(50% - 28px);\n                width: 264px;\n                left: calc(50% - 132px);\n            }\n\n            #application-splash img {\n                width: 100%;\n            }\n\n            #progress-bar-container {\n                margin: 20px auto 0 auto;\n                height: 2px;\n                width: 100%;\n                background-color: #1d292c;\n            }\n\n            #progress-bar {\n                width: 0%;\n                height: 100%;\n                background-color: #f60;\n            }\n\n            @media (max-width: 480px) {\n                #application-splash {\n                    width: 170px;\n                    left: calc(50% - 85px);\n                }\n            }\n        ")),document.head.appendChild(e),function(){var n=document.createElement("div");n.id="application-splash-wrapper",document.body.appendChild(n);var e=document.createElement("div");e.id="application-splash",n.appendChild(e),e.style.display="none";var t=document.createElement("img");t.src="https://games.joycode.co.uk/firewise.png",e.appendChild(t),t.onload=function(){e.style.display="block"};var a=document.createElement("div");a.id="progress-bar-container",e.appendChild(a);var o=document.createElement("div");o.id="progress-bar",a.appendChild(o)}(),n.on("preload:end",(function(){n.off("preload:progress")})),n.on("preload:progress",(function(n){var e=document.getElementById("progress-bar");e&&(n=Math.min(1,Math.max(0,n)),e.style.width=100*n+"%")})),n.on("start",(function(){var n=document.getElementById("application-splash-wrapper");n&&n.parentElement&&n.parentElement.removeChild(n)}))}));var TeleEsc=pc.createScript("teleEsc");TeleEsc.prototype.initialize=function(){const onTriggerEnter=e=>{if(e.script&&e.script.movement){const t=this.app.root.findByName("home-esc");if(t){const o=t.getPosition().clone();o.y+=.5,e.script.movement.teleport(o),console.log("Teleported to home-esc.")}else console.warn("home-esc entity not found");const o={"Wildfire-screen":!1,"Start-screen":!1,"Home-screen":!0};for(const[e,t]of Object.entries(o)){const o=this.app.root.findByName(e);o?(o.enabled=t,console.log(`${e} set to ${t?"enabled":"disabled"}`)):console.warn(`${e} entity not found`)}}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var TeleStop=pc.createScript("teleStop");TeleStop.prototype.initialize=function(){if(this.target=this.app.root.findByName("StopDrop"),!this.target)return void console.warn("teleStop.js: 'StopDrop' entity not found.");const onTriggerEnter=t=>{if(t.script&&t.script.movement){const e=this.target.getPosition().clone();e.y+=.5,t.script.movement.teleport(e)}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var StopDropInput=pc.createScript("stopDropInput");StopDropInput.prototype.initialize=function(){this.app.keyboard.on("keydown",this.handleKey,this)},StopDropInput.prototype.handleKey=function(t){switch(t.key){case pc.KEY_S:console.log("Stop key pressed"),this.entity.script&&this.entity.script.movement?(this.entity.script.movement.enabled=!1,console.log("Movement script disabled.")):console.warn("stopDropInput.js: movement script not found.");break;case pc.KEY_D:console.log("Drop key pressed"),this.entity.script&&this.entity.script.capsuleSwap?this.entity.script.capsuleSwap.handleDrop(t):console.warn("stopDropInput.js: capsuleSwap script not found.");break;case pc.KEY_R:console.log("Roll key pressed"),this.entity.script&&this.entity.script.rollTimer?this.entity.script.rollTimer.handleRoll(t):console.warn("stopDropInput.js: rollTimer script not found.")}},StopDropInput.prototype.destroy=function(){this.app.keyboard.off("keydown",this.handleKey,this)};var CapsuleSwap=pc.createScript("capsuleSwap");CapsuleSwap.attributes.add("capsuleTemplate",{type:"entity",title:"Capsule Template",description:"The fire capsule to spawn after Drop"}),CapsuleSwap.prototype.initialize=function(){this.app.keyboard.on("keydown",this.handleKey,this)},CapsuleSwap.prototype.handleKey=function(e){e.key===pc.KEY_D&&this.handleDrop()},CapsuleSwap.prototype.handleDrop=function(){const e=this.entity.getPosition().clone();if(this.entity.destroy(),this.capsuleTemplate){const t=this.capsuleTemplate.clone();this.app.root.addChild(t),t.setPosition(e),t.enabled=!0,console.log("Fire capsule spawned."),t.script&&t.script.rollTimer?t.script.rollTimer.handleRoll():console.warn("capsuleSwap.js: rollTimer script not found on capsule.")}else console.warn("capsuleSwap.js: Capsule template not assigned.")},CapsuleSwap.prototype.destroy=function(){this.app.keyboard.off("keydown",this.handleKey,this)};var RollTimer=pc.createScript("rollTimer");RollTimer.attributes.add("rollDuration",{type:"number",default:5,title:"Roll Duration",description:"Time in seconds for left/right-only movement"}),RollTimer.prototype.initialize=function(){this.rolling=!1},RollTimer.prototype.handleRoll=function(){this.rolling||(this.rolling=!0,console.log("Roll started"),this.entity.script&&this.entity.script.rollMovement&&(this.entity.script.rollMovement.rollOnly=!0),this.app.once("rollTimer:restore",(()=>{this.rolling=!1,console.log("Roll ended"),this.entity.destroy();const t=this.app.root.findByName("BallTemplate");if(t){const l=t.clone();this.app.root.addChild(l),l.setPosition(this.entity.getPosition()),l.enabled=!0,console.log("Ball respawned.")}else console.warn("rollTimer.js: BallTemplate not found.")})),setTimeout((()=>{this.app.fire("rollTimer:restore")}),1e3*this.rollDuration))};var RollMovement=pc.createScript("rollMovement");RollMovement.prototype.initialize=function(){this.rollOnly=!0,this.speed=3},RollMovement.prototype.update=function(t){if(!this.rollOnly)return;const e=this.app.keyboard,i=this.entity.getPosition();e.isPressed(pc.KEY_LEFT)&&(i.x-=this.speed*t),e.isPressed(pc.KEY_RIGHT)&&(i.x+=this.speed*t),this.entity.setPosition(i)};var TeleEnd=pc.createScript("teleEnd");TeleEnd.prototype.initialize=function(){const onTriggerEnter=e=>{if(e.script&&e.script.movement&&!e.script.movement.hasTeleportedToEnd){const t=this.app.root.findByName("End");if(t){const o=t.getPosition().clone();o.y+=.5,e.script.movement.teleport(o),e.script.movement.hasTeleportedToEnd=!0,console.log("Teleported to End.")}else console.warn("teleEnd.js: End entity not found.")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var XboxInput=pc.createScript("xboxInput");XboxInput.attributes.add("speed",{type:"number",default:5,title:"Movement Speed"}),XboxInput.prototype.initialize=function(){this.padIndex=0},XboxInput.prototype.update=function(t){var e=navigator.getGamepads()[this.padIndex];if(e){var s=e.axes[0]||0,n=e.axes[1]||0,i=new pc.Vec3(s*this.speed,0,-n*this.speed);this.entity.translate(i.scale(t)),e.buttons[0].pressed&&(this.entity.script&&this.entity.script.movement?(this.entity.script.movement.enabled=!1,console.log("Stop triggered (A)")):console.warn("xboxInput.js: movement script not found.")),e.buttons[1].pressed&&(this.entity.script&&this.entity.script.capsuleSwap?(this.entity.script.capsuleSwap.handleDrop(),console.log("Drop triggered (B)")):console.warn("xboxInput.js: capsuleSwap script not found.")),e.buttons[3].pressed&&(this.entity.script&&this.entity.script.rollTimer?(this.entity.script.rollTimer.handleRoll(),console.log("Roll triggered (Y)")):console.warn("xboxInput.js: rollTimer script not found."))}};var PsInput=pc.createScript("psInput");PsInput.attributes.add("speed",{type:"number",default:5,title:"Movement Speed"}),PsInput.prototype.initialize=function(){this.padIndex=0},PsInput.prototype.update=function(t){var e=navigator.getGamepads()[this.padIndex];if(e){var s=e.axes[0]||0,i=e.axes[1]||0,n=new pc.Vec3(s*this.speed,0,-i*this.speed);this.entity.translate(n.scale(t)),e.buttons[0].pressed&&(this.entity.script&&this.entity.script.movement?(this.entity.script.movement.enabled=!1,console.log("Stop triggered (Cross)")):console.warn("psInput.js: movement script not found.")),e.buttons[1].pressed&&(this.entity.script&&this.entity.script.capsuleSwap?(this.entity.script.capsuleSwap.handleDrop(),console.log("Drop triggered (Circle)")):console.warn("psInput.js: capsuleSwap script not found.")),e.buttons[3].pressed&&(this.entity.script&&this.entity.script.rollTimer?(this.entity.script.rollTimer.handleRoll(),console.log("Roll triggered (Triangle)")):console.warn("psInput.js: rollTimer script not found."))}};