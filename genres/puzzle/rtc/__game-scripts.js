var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),FollowCamera.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),FollowCamera.prototype.initialize=function(){this.pos=new pc.Vec3,this.offset=new pc.Vec3},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.offset.set(.75,1,.75).scale(this.distance),this.pos.copy(this.target.getPosition()).add(this.offset),this.pos.lerp(this.entity.getPosition(),this.pos,.1),this.entity.setPosition(this.pos))};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.spawnPos=this.entity.getPosition().clone()},Movement.prototype.update=function(e){if(this.entity.getPosition().y<-1)return void this.teleport(this.spawnPos);const t=this.app.keyboard;let s=0,i=0;if((t.isPressed(pc.KEY_LEFT)||t.isPressed(pc.KEY_A))&&(s=-this.speed),(t.isPressed(pc.KEY_RIGHT)||t.isPressed(pc.KEY_D))&&(s+=this.speed),(t.isPressed(pc.KEY_UP)||t.isPressed(pc.KEY_W))&&(i=-this.speed),(t.isPressed(pc.KEY_DOWN)||t.isPressed(pc.KEY_S))&&(i+=this.speed),this.force.set(s,0,i),this.force.lengthSq()>0){this.force.normalize().scale(this.speed);const e=.25*-Math.PI,t=Math.cos(e),s=Math.sin(e),i=this.force.x*t-this.force.z*s,o=this.force.z*t+this.force.x*s;this.force.set(i,0,o)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.teleport=function(e){this.entity.rigidbody.teleport(e),this.spawnPos.copy(e),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO};var Teleporter=pc.createScript("teleporter");Teleporter.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.target.getPosition().clone();e.y+=.5,t.script.movement.teleport(e)}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var Teleporter=pc.createScript("teleporter1");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start1");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start1 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var Teleporter=pc.createScript("teleporter2");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start2");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start2 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var TouchJoystickInvisible=pc.createScript("touchJoystickInvisible");TouchJoystickInvisible.attributes.add("sensitivity",{type:"number",default:1,title:"Sensitivity"}),TouchJoystickInvisible.prototype.direction=new pc.Vec2,TouchJoystickInvisible.prototype.initialize=function(){this.touchId=null,this.startPos=new pc.Vec2,this.currentPos=new pc.Vec2,this.app.touchDevice?(this.app.touchDevice.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touchDevice.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touchDevice.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),console.log("TouchJoystickInvisible initialized")):console.warn("Touch device not detected â€” joystick disabled")},TouchJoystickInvisible.prototype.onTouchStart=function(t){if(null!==this.touchId)return;const i=t.changedTouches[0];this.touchId=i.identifier,this.startPos.set(i.x,i.y),this.currentPos.copy(this.startPos),this.direction.set(0,0),console.log("Touch START:",i.x,i.y)},TouchJoystickInvisible.prototype.onTouchMove=function(t){for(let i=0;i<t.changedTouches.length;i++){const o=t.changedTouches[i];if(o.identifier===this.touchId){this.currentPos.set(o.x,o.y);const t=this.currentPos.x-this.startPos.x,i=this.currentPos.y-this.startPos.y;this.direction.set(t,i).normalize().scale(this.sensitivity),console.log("Touch MOVE:",this.direction.x.toFixed(2),this.direction.y.toFixed(2))}}},TouchJoystickInvisible.prototype.onTouchEnd=function(t){for(let i=0;i<t.changedTouches.length;i++){t.changedTouches[i].identifier===this.touchId&&(this.touchId=null,this.direction.set(0,0),console.log("Touch END"))}};var Telekey=pc.createScript("telekey");Telekey.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Telekey.prototype.onTriggerEnter=function(e){if("Ball"===e.name){var t=this.app.root.findByName("Gate");t&&t.destroy()}};var Teleporter=pc.createScript("teleporter3");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start3");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start3 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var Teleporter=pc.createScript("teleporter4");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start4");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start4 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var CrumblerTile=pc.createScript("crumblerTile");CrumblerTile.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},CrumblerTile.prototype.onTriggerEnter=function(e){"Ball"===e.name&&this.entity.destroy()};var Telekey=pc.createScript("telekey2");Telekey.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Telekey.prototype.onTriggerEnter=function(e){if("Ball"===e.name){var t=this.app.root.findByName("Gate2");t&&t.destroy()}};var Teleporter=pc.createScript("teleporter5");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start5");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start5 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var Teleporter=pc.createScript("teleporter6");Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.app.root.findByName("Start6");if(e){const o=e.getPosition().clone();o.y+=.5,t.script.movement.teleport(o)}else console.warn("Start6 entity not found")}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var TrapTrigger=pc.createScript("trapTrigger");TrapTrigger.prototype.initialize=function(){const onTriggerEnter=i=>{if(i.script.movement&&i.rigidbody){const t=new pc.Vec3(-30,10,0);i.rigidbody.applyImpulse(t),this.app.fire("trap:activated",this.entity.name)}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};class MusicPlayer extends pc.ScriptType{initialize(){this.entity.addComponent("sound",{volume:.5});const e=this.app.assets.find("background_music.mp3");e&&e.loaded?this.setupKeyTrigger(e):(e.once("load",(()=>{this.setupKeyTrigger(e)})),this.app.assets.load(e))}setupKeyTrigger(e){const playMusic=()=>{this.entity.sound.addSlot("bgm",{asset:e,loop:!0,autoPlay:!1}),this.entity.sound.play("bgm"),window.removeEventListener("keydown",keyListener)},keyListener=e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyA","KeyS","KeyD"].includes(e.code)&&playMusic()};window.addEventListener("keydown",keyListener)}}pc.registerScript(MusicPlayer,"musicPlayer");